#!/bin/bash
# Runs tests in Bamboo

set -ex

# Remove cached bytecode Python files, to ensure latest code is used
find . | grep -E "(__pycache__|\.pyc|\.pyo$)" | xargs rm -rf

# Make the directory into which XML format test reports will be saved
mkdir test-reports

# Make the directory into which coverage reports will be saved
mkdir coverage

# Run the tests in a Docker container with mounted volumes for XML report
# output and test coverage reporting
docker run --rm \
	-v $(pwd)/test-reports:/home/test/reports \
	-v $(pwd)/coverage:/home/test/coverage \
	sds/swot-reproject-test "$@"
